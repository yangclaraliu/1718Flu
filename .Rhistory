for(i in 1:length(onset_sim)){
ILI_temp <- c(today$`% WEIGHTED ILI`,sim_res_all[[h]][,i])
above_bl <- (intersect(intersect(which(ILI_temp>baseline[h+1,13]),which(ILI_temp>baseline[h+1,13])+1),which(ILI_temp>baseline[h+1,13])+2)-2)
if (length(above_bl)!=0)  {onset_sim[i] <- min(above_bl)} else {onset_sim[i] <- NA}
peaksize_sim[i] <- max(ILI_temp)
peaktime_sim[i] <- which.max(ILI_temp)
}
layout(matrix(c(rep(1,9),2),nrow=10))
par(mar=c(1,5.1,2.4,2.1))
plot(0,ylim=c(0,10),xlim=c(1,52),ylab="wILI%",xlab="Week",xaxt='n',col='white',main=paste("HumNat ENVR - HHS Region",h),cex.main=2,cex.lab=2)
for(yr in 1997:2016) lines(get_flu_data("hhs",h,"ilinet",years=yr)$`% WEIGHTED ILI`,col="grey90",lwd=2)
points(y=today$`% WEIGHTED ILI`,x=1:(cur.week-40+1),pch=19,col="grey50",)
lines(y=today$`% WEIGHTED ILI`,x=1:(cur.week-40+1),col="grey50",lwd=3)
lines(y=c(tail(today$`% WEIGHTED ILI`,1),rowMeans(sim_res_all[[h]])[1:4]),x=(cur.week-40+1):(cur.week-40+5),col="#FF69B4")
points(y=rowMeans(sim_res_all[[h]])[1:4],x= (cur.week-40+2):(cur.week-40+5), col=	"#FF69B4",pch=21,bg="white")
abline(v=(cur.week-40+3),lty=2)
abline(h=baseline[h+1,13],lty=2)
points(y=mean(peaksize_sim),x=mean(peaktime_sim),pch=19,col="#FF69B4")
lines(y=rep(mean(peaksize_sim),2),x=quantile(peaktime_sim,c(0.25,0.75)),col="#FF69B4",lty=2)
lines(y=c(mean(peaksize_sim)+0.15,mean(peaksize_sim)-0.15),x=rep(quantile(peaktime_sim,c(0.25)),2),col="#FF69B4")
lines(y=c(mean(peaksize_sim)+0.15,mean(peaksize_sim)-0.15),x=rep(quantile(peaktime_sim,c(0.75)),2),col="#FF69B4")
lines(x=rep(mean(peaktime_sim),2),y=quantile(peaksize_sim,c(0.25,0.75)),col="#FF69B4",lty=2)
lines(y=rep(quantile(peaksize_sim,c(0.25)),2),x=c(mean(peaktime_sim)+0.3,mean(peaktime_sim)-0.3),col="#FF69B4")
lines(y=rep(quantile(peaksize_sim,c(0.75)),2),x=c(mean(peaktime_sim)+0.3,mean(peaktime_sim)-0.3),col="#FF69B4")
dev.off()
h=5
setwd("~/Google Drive/Influenza/17-18_forecast/HumNat/html")
jpeg(paste("Report_",report,"_HHS_",h,'.jpeg',sep=""))
today <- get_flu_data("hhs",h,"ilinet",2017)
onset_sim <- peaksize_sim <- peaktime_sim <- rep(NA,ncol(sim_res_all[[h]]))
for(i in 1:length(onset_sim)){
ILI_temp <- c(today$`% WEIGHTED ILI`,sim_res_all[[h]][,i])
above_bl <- (intersect(intersect(which(ILI_temp>baseline[h+1,13]),which(ILI_temp>baseline[h+1,13])+1),which(ILI_temp>baseline[h+1,13])+2)-2)
if (length(above_bl)!=0)  {onset_sim[i] <- min(above_bl)} else {onset_sim[i] <- NA}
peaksize_sim[i] <- max(ILI_temp)
peaktime_sim[i] <- which.max(ILI_temp)
}
layout(matrix(c(rep(1,9),2),nrow=10))
par(mar=c(1,5.1,2.4,2.1))
plot(0,ylim=c(0,10),xlim=c(1,52),ylab="wILI%",xlab="Week",xaxt='n',col='white',main=paste("HumNat ENVR - HHS Region",h),cex.main=2,cex.lab=2)
for(yr in 1997:2016) lines(get_flu_data("hhs",h,"ilinet",years=yr)$`% WEIGHTED ILI`,col="grey90",lwd=2)
points(y=today$`% WEIGHTED ILI`,x=1:(cur.week-40+1),pch=19,col="grey50",)
lines(y=today$`% WEIGHTED ILI`,x=1:(cur.week-40+1),col="grey50",lwd=3)
lines(y=c(tail(today$`% WEIGHTED ILI`,1),rowMeans(sim_res_all[[h]])[1:4]),x=(cur.week-40+1):(cur.week-40+5),col="#FF69B4")
points(y=rowMeans(sim_res_all[[h]])[1:4],x= (cur.week-40+2):(cur.week-40+5), col=	"#FF69B4",pch=21,bg="white")
abline(v=(cur.week-40+3),lty=2)
abline(h=baseline[h+1,13],lty=2)
points(y=mean(peaksize_sim),x=mean(peaktime_sim),pch=19,col="#FF69B4")
lines(y=rep(mean(peaksize_sim),2),x=quantile(peaktime_sim,c(0.25,0.75)),col="#FF69B4",lty=2)
lines(y=c(mean(peaksize_sim)+0.15,mean(peaksize_sim)-0.15),x=rep(quantile(peaktime_sim,c(0.25)),2),col="#FF69B4")
lines(y=c(mean(peaksize_sim)+0.15,mean(peaksize_sim)-0.15),x=rep(quantile(peaktime_sim,c(0.75)),2),col="#FF69B4")
lines(x=rep(mean(peaktime_sim),2),y=quantile(peaksize_sim,c(0.25,0.75)),col="#FF69B4",lty=2)
lines(y=rep(quantile(peaksize_sim,c(0.25)),2),x=c(mean(peaktime_sim)+0.3,mean(peaktime_sim)-0.3),col="#FF69B4")
lines(y=rep(quantile(peaksize_sim,c(0.75)),2),x=c(mean(peaktime_sim)+0.3,mean(peaktime_sim)-0.3),col="#FF69B4")
par(mar=c(5.1,5.1,0,2.1))
plot(x=mean(onset_sim,na.rm=T),xlim=c(1,52),y=1,xaxt='n',yaxt="n",ylab="",xlab="Week",pch=19, col="#FF69B4",cex.lab=2)
axis(1,at=1:52,labels=c(40:52,1:39))
lines(x=quantile(onset_sim,na.rm=T,c(0.25,0.75)),y=rep(1,2),col="#FF69B4",lty=2)
lines(x=rep(quantile(onset_sim,na.rm=T,c(0.25)),2),y=c(1-0.1,1+0.1),col="#FF69B4")
lines(x=rep(quantile(onset_sim,na.rm=T,c(0.75)),2),y=c(1-0.1,1+0.1),col="#FF69B4")
mtext(expression("Onset\nWeek"),side=2,las=1,line=1,cex=0.75,padj=1)
dev.off()
pdf(paste("Report_",report,"_HHS_",h,'.pdf',sep=""))
today <- get_flu_data("hhs",h,"ilinet",2017)
onset_sim <- peaksize_sim <- peaktime_sim <- rep(NA,ncol(sim_res_all[[h]]))
for(i in 1:length(onset_sim)){
ILI_temp <- c(today$`% WEIGHTED ILI`,sim_res_all[[h]][,i])
above_bl <- (intersect(intersect(which(ILI_temp>baseline[h+1,13]),which(ILI_temp>baseline[h+1,13])+1),which(ILI_temp>baseline[h+1,13])+2)-2)
if (length(above_bl)!=0)  {onset_sim[i] <- min(above_bl)} else {onset_sim[i] <- NA}
peaksize_sim[i] <- max(ILI_temp)
peaktime_sim[i] <- which.max(ILI_temp)
}
layout(matrix(c(rep(1,9),2),nrow=10))
par(mar=c(1,5.1,2.4,2.1))
plot(0,ylim=c(0,10),xlim=c(1,52),ylab="wILI%",xlab="Week",xaxt='n',col='white',main=paste("HumNat ENVR - HHS Region",h),cex.main=2,cex.lab=2)
for(yr in 1997:2016) lines(get_flu_data("hhs",h,"ilinet",years=yr)$`% WEIGHTED ILI`,col="grey90",lwd=2)
points(y=today$`% WEIGHTED ILI`,x=1:(cur.week-40+1),pch=19,col="grey50",)
lines(y=today$`% WEIGHTED ILI`,x=1:(cur.week-40+1),col="grey50",lwd=3)
lines(y=c(tail(today$`% WEIGHTED ILI`,1),rowMeans(sim_res_all[[h]])[1:4]),x=(cur.week-40+1):(cur.week-40+5),col="#FF69B4")
points(y=rowMeans(sim_res_all[[h]])[1:4],x= (cur.week-40+2):(cur.week-40+5), col=	"#FF69B4",pch=21,bg="white")
abline(v=(cur.week-40+3),lty=2)
abline(h=baseline[h+1,13],lty=2)
points(y=mean(peaksize_sim),x=mean(peaktime_sim),pch=19,col="#FF69B4")
lines(y=rep(mean(peaksize_sim),2),x=quantile(peaktime_sim,c(0.25,0.75)),col="#FF69B4",lty=2)
lines(y=c(mean(peaksize_sim)+0.15,mean(peaksize_sim)-0.15),x=rep(quantile(peaktime_sim,c(0.25)),2),col="#FF69B4")
lines(y=c(mean(peaksize_sim)+0.15,mean(peaksize_sim)-0.15),x=rep(quantile(peaktime_sim,c(0.75)),2),col="#FF69B4")
lines(x=rep(mean(peaktime_sim),2),y=quantile(peaksize_sim,c(0.25,0.75)),col="#FF69B4",lty=2)
lines(y=rep(quantile(peaksize_sim,c(0.25)),2),x=c(mean(peaktime_sim)+0.3,mean(peaktime_sim)-0.3),col="#FF69B4")
lines(y=rep(quantile(peaksize_sim,c(0.75)),2),x=c(mean(peaktime_sim)+0.3,mean(peaktime_sim)-0.3),col="#FF69B4")
par(mar=c(5.1,5.1,0,2.1))
plot(x=mean(onset_sim,na.rm=T),xlim=c(1,52),y=1,xaxt='n',yaxt="n",ylab="",xlab="Week",pch=19, col="#FF69B4",cex.lab=2)
axis(1,at=1:52,labels=c(40:52,1:39))
lines(x=quantile(onset_sim,na.rm=T,c(0.25,0.75)),y=rep(1,2),col="#FF69B4",lty=2)
lines(x=rep(quantile(onset_sim,na.rm=T,c(0.25)),2),y=c(1-0.1,1+0.1),col="#FF69B4")
lines(x=rep(quantile(onset_sim,na.rm=T,c(0.75)),2),y=c(1-0.1,1+0.1),col="#FF69B4")
mtext(expression("Onset\nWeek"),side=2,las=1,line=1,cex=0.75,padj=1)
dev.off()
h=5
setwd("~/Google Drive/Influenza/17-18_forecast/HumNat/html")
pdf(paste("Report_",report,"_HHS_",h,'.pdf',sep=""))
today <- get_flu_data("hhs",h,"ilinet",2017)
onset_sim <- peaksize_sim <- peaktime_sim <- rep(NA,ncol(sim_res_all[[h]]))
for(i in 1:length(onset_sim)){
ILI_temp <- c(today$`% WEIGHTED ILI`,sim_res_all[[h]][,i])
above_bl <- (intersect(intersect(which(ILI_temp>baseline[h+1,13]),which(ILI_temp>baseline[h+1,13])+1),which(ILI_temp>baseline[h+1,13])+2)-2)
if (length(above_bl)!=0)  {onset_sim[i] <- min(above_bl)} else {onset_sim[i] <- NA}
peaksize_sim[i] <- max(ILI_temp)
peaktime_sim[i] <- which.max(ILI_temp)
}
layout(matrix(c(rep(1,8),2),nrow=9))
par(mar=c(1,5.1,2.4,2.1))
plot(0,ylim=c(0,10),xlim=c(1,52),ylab="wILI%",xlab="Week",xaxt='n',col='white',main=paste("HumNat ENVR - HHS Region",h),cex.main=2,cex.lab=2)
for(yr in 1997:2016) lines(get_flu_data("hhs",h,"ilinet",years=yr)$`% WEIGHTED ILI`,col="grey90",lwd=2)
points(y=today$`% WEIGHTED ILI`,x=1:(cur.week-40+1),pch=19,col="grey50",)
lines(y=today$`% WEIGHTED ILI`,x=1:(cur.week-40+1),col="grey50",lwd=3)
lines(y=c(tail(today$`% WEIGHTED ILI`,1),rowMeans(sim_res_all[[h]])[1:4]),x=(cur.week-40+1):(cur.week-40+5),col="#FF69B4")
points(y=rowMeans(sim_res_all[[h]])[1:4],x= (cur.week-40+2):(cur.week-40+5), col=	"#FF69B4",pch=21,bg="white")
abline(v=(cur.week-40+3),lty=2)
abline(h=baseline[h+1,13],lty=2)
points(y=mean(peaksize_sim),x=mean(peaktime_sim),pch=19,col="#FF69B4")
lines(y=rep(mean(peaksize_sim),2),x=quantile(peaktime_sim,c(0.25,0.75)),col="#FF69B4",lty=2)
lines(y=c(mean(peaksize_sim)+0.15,mean(peaksize_sim)-0.15),x=rep(quantile(peaktime_sim,c(0.25)),2),col="#FF69B4")
lines(y=c(mean(peaksize_sim)+0.15,mean(peaksize_sim)-0.15),x=rep(quantile(peaktime_sim,c(0.75)),2),col="#FF69B4")
lines(x=rep(mean(peaktime_sim),2),y=quantile(peaksize_sim,c(0.25,0.75)),col="#FF69B4",lty=2)
lines(y=rep(quantile(peaksize_sim,c(0.25)),2),x=c(mean(peaktime_sim)+0.3,mean(peaktime_sim)-0.3),col="#FF69B4")
lines(y=rep(quantile(peaksize_sim,c(0.75)),2),x=c(mean(peaktime_sim)+0.3,mean(peaktime_sim)-0.3),col="#FF69B4")
par(mar=c(5.1,5.1,0,2.1))
plot(x=mean(onset_sim,na.rm=T),xlim=c(1,52),y=1,xaxt='n',yaxt="n",ylab="",xlab="Week",pch=19, col="#FF69B4",cex.lab=2)
axis(1,at=1:52,labels=c(40:52,1:39))
lines(x=quantile(onset_sim,na.rm=T,c(0.25,0.75)),y=rep(1,2),col="#FF69B4",lty=2)
lines(x=rep(quantile(onset_sim,na.rm=T,c(0.25)),2),y=c(1-0.1,1+0.1),col="#FF69B4")
lines(x=rep(quantile(onset_sim,na.rm=T,c(0.75)),2),y=c(1-0.1,1+0.1),col="#FF69B4")
mtext(expression("Onset\nWeek"),side=2,las=1,line=1,cex=0.75,padj=1)
dev.off()
h=5
setwd("~/Google Drive/Influenza/17-18_forecast/HumNat/html")
pdf(paste("Report_",report,"_HHS_",h,'.pdf',sep=""))
today <- get_flu_data("hhs",h,"ilinet",2017)
onset_sim <- peaksize_sim <- peaktime_sim <- rep(NA,ncol(sim_res_all[[h]]))
for(i in 1:length(onset_sim)){
ILI_temp <- c(today$`% WEIGHTED ILI`,sim_res_all[[h]][,i])
above_bl <- (intersect(intersect(which(ILI_temp>baseline[h+1,13]),which(ILI_temp>baseline[h+1,13])+1),which(ILI_temp>baseline[h+1,13])+2)-2)
if (length(above_bl)!=0)  {onset_sim[i] <- min(above_bl)} else {onset_sim[i] <- NA}
peaksize_sim[i] <- max(ILI_temp)
peaktime_sim[i] <- which.max(ILI_temp)
}
layout(matrix(c(rep(1,8),2),nrow=9))
par(mar=c(1,5.1,2.4,2.1))
plot(0,ylim=c(0,10),xlim=c(1,52),ylab="wILI%",xlab="Week",xaxt='n',col='white',main=paste("HumNat ENVR - HHS Region",h),cex.main=2)
for(yr in 1997:2016) lines(get_flu_data("hhs",h,"ilinet",years=yr)$`% WEIGHTED ILI`,col="grey90",lwd=2)
points(y=today$`% WEIGHTED ILI`,x=1:(cur.week-40+1),pch=19,col="grey50",)
lines(y=today$`% WEIGHTED ILI`,x=1:(cur.week-40+1),col="grey50",lwd=3)
lines(y=c(tail(today$`% WEIGHTED ILI`,1),rowMeans(sim_res_all[[h]])[1:4]),x=(cur.week-40+1):(cur.week-40+5),col="#FF69B4")
points(y=rowMeans(sim_res_all[[h]])[1:4],x= (cur.week-40+2):(cur.week-40+5), col=	"#FF69B4",pch=21,bg="white")
abline(v=(cur.week-40+3),lty=2)
abline(h=baseline[h+1,13],lty=2)
points(y=mean(peaksize_sim),x=mean(peaktime_sim),pch=19,col="#FF69B4")
lines(y=rep(mean(peaksize_sim),2),x=quantile(peaktime_sim,c(0.25,0.75)),col="#FF69B4",lty=2)
lines(y=c(mean(peaksize_sim)+0.15,mean(peaksize_sim)-0.15),x=rep(quantile(peaktime_sim,c(0.25)),2),col="#FF69B4")
lines(y=c(mean(peaksize_sim)+0.15,mean(peaksize_sim)-0.15),x=rep(quantile(peaktime_sim,c(0.75)),2),col="#FF69B4")
lines(x=rep(mean(peaktime_sim),2),y=quantile(peaksize_sim,c(0.25,0.75)),col="#FF69B4",lty=2)
lines(y=rep(quantile(peaksize_sim,c(0.25)),2),x=c(mean(peaktime_sim)+0.3,mean(peaktime_sim)-0.3),col="#FF69B4")
lines(y=rep(quantile(peaksize_sim,c(0.75)),2),x=c(mean(peaktime_sim)+0.3,mean(peaktime_sim)-0.3),col="#FF69B4")
par(mar=c(5.1,5.1,0,2.1))
plot(x=mean(onset_sim,na.rm=T),xlim=c(1,52),y=1,xaxt='n',yaxt="n",ylab="",xlab="Week",pch=19, col="#FF69B4")
axis(1,at=1:52,labels=c(40:52,1:39))
lines(x=quantile(onset_sim,na.rm=T,c(0.25,0.75)),y=rep(1,2),col="#FF69B4",lty=2)
lines(x=rep(quantile(onset_sim,na.rm=T,c(0.25)),2),y=c(1-0.1,1+0.1),col="#FF69B4")
lines(x=rep(quantile(onset_sim,na.rm=T,c(0.75)),2),y=c(1-0.1,1+0.1),col="#FF69B4")
mtext(expression("Onset\nWeek"),side=2,las=1,line=1,cex=0.75,padj=1)
dev.off()
layout(matrix(c(rep(1,8),2),nrow=9))
par(mar=c(1,5.1,2.4,2.1))
plot(0,ylim=c(0,10),xlim=c(1,52),ylab="wILI%",xlab="Week",xaxt='n',col='white',main=paste("HumNat ENVR - HHS Region",h),cex.main=2)
for(yr in 1997:2016) lines(get_flu_data("hhs",h,"ilinet",years=yr)$`% WEIGHTED ILI`,col="grey90",lwd=2)
points(y=today$`% WEIGHTED ILI`,x=1:(cur.week-40+1),pch=19,col="grey50",)
lines(y=today$`% WEIGHTED ILI`,x=1:(cur.week-40+1),col="grey50",lwd=3)
lines(y=c(tail(today$`% WEIGHTED ILI`,1),rowMeans(sim_res_all[[h]])[1:4]),x=(cur.week-40+1):(cur.week-40+5),col="#FF69B4")
points(y=rowMeans(sim_res_all[[h]])[1:4],x= (cur.week-40+2):(cur.week-40+5), col=	"#FF69B4",pch=21,bg="white")
abline(v=(cur.week-40+3),lty=2)
abline(h=baseline[h+1,13],lty=2)
points(y=mean(peaksize_sim),x=mean(peaktime_sim),pch=19,col="#FF69B4")
lines(y=rep(mean(peaksize_sim),2),x=quantile(peaktime_sim,c(0.25,0.75)),col="#FF69B4",lty=2)
lines(y=c(mean(peaksize_sim)+0.15,mean(peaksize_sim)-0.15),x=rep(quantile(peaktime_sim,c(0.25)),2),col="#FF69B4")
lines(y=c(mean(peaksize_sim)+0.15,mean(peaksize_sim)-0.15),x=rep(quantile(peaktime_sim,c(0.75)),2),col="#FF69B4")
lines(x=rep(mean(peaktime_sim),2),y=quantile(peaksize_sim,c(0.25,0.75)),col="#FF69B4",lty=2)
lines(y=rep(quantile(peaksize_sim,c(0.25)),2),x=c(mean(peaktime_sim)+0.3,mean(peaktime_sim)-0.3),col="#FF69B4")
lines(y=rep(quantile(peaksize_sim,c(0.75)),2),x=c(mean(peaktime_sim)+0.3,mean(peaktime_sim)-0.3),col="#FF69B4")
par(mar=c(5.1,5.1,0,2.1))
plot(x=mean(onset_sim,na.rm=T),xlim=c(1,52),y=1,xaxt='n',yaxt="n",ylab="",xlab="Week",pch=19, col="#FF69B4")
axis(1,at=1:52,labels=c(40:52,1:39))
lines(x=quantile(onset_sim,na.rm=T,c(0.25,0.75)),y=rep(1,2),col="#FF69B4",lty=2)
lines(x=rep(quantile(onset_sim,na.rm=T,c(0.25)),2),y=c(1-0.1,1+0.1),col="#FF69B4")
lines(x=rep(quantile(onset_sim,na.rm=T,c(0.75)),2),y=c(1-0.1,1+0.1),col="#FF69B4")
mtext(expression("Onset\nWeek"),side=2,las=1,line=1,cex=0.75,padj=1)
?jpeg
jpeg(paste("Report",report,"_HHS",h,'.jpeg',sep=""),width=918,height=880)
today <- get_flu_data("hhs",h,"ilinet",2017)
onset_sim <- peaksize_sim <- peaktime_sim <- rep(NA,ncol(sim_res_all[[h]]))
for(i in 1:length(onset_sim)){
ILI_temp <- c(today$`% WEIGHTED ILI`,sim_res_all[[h]][,i])
above_bl <- (intersect(intersect(which(ILI_temp>baseline[h+1,13]),which(ILI_temp>baseline[h+1,13])+1),which(ILI_temp>baseline[h+1,13])+2)-2)
if (length(above_bl)!=0)  {onset_sim[i] <- min(above_bl)} else {onset_sim[i] <- NA}
peaksize_sim[i] <- max(ILI_temp)
peaktime_sim[i] <- which.max(ILI_temp)
}
layout(matrix(c(rep(1,8),2),nrow=9))
par(mar=c(1,5.1,2.4,2.1))
plot(0,ylim=c(0,10),xlim=c(1,52),ylab="wILI%",xlab="Week",xaxt='n',col='white',main=paste("HumNat ENVR - HHS Region",h),cex.main=2)
for(yr in 1997:2016) lines(get_flu_data("hhs",h,"ilinet",years=yr)$`% WEIGHTED ILI`,col="grey90",lwd=2)
points(y=today$`% WEIGHTED ILI`,x=1:(cur.week-40+1),pch=19,col="grey50",)
lines(y=today$`% WEIGHTED ILI`,x=1:(cur.week-40+1),col="grey50",lwd=3)
lines(y=c(tail(today$`% WEIGHTED ILI`,1),rowMeans(sim_res_all[[h]])[1:4]),x=(cur.week-40+1):(cur.week-40+5),col="#FF69B4")
points(y=rowMeans(sim_res_all[[h]])[1:4],x= (cur.week-40+2):(cur.week-40+5), col=	"#FF69B4",pch=21,bg="white")
abline(v=(cur.week-40+3),lty=2)
abline(h=baseline[h+1,13],lty=2)
points(y=mean(peaksize_sim),x=mean(peaktime_sim),pch=19,col="#FF69B4")
lines(y=rep(mean(peaksize_sim),2),x=quantile(peaktime_sim,c(0.25,0.75)),col="#FF69B4",lty=2)
lines(y=c(mean(peaksize_sim)+0.15,mean(peaksize_sim)-0.15),x=rep(quantile(peaktime_sim,c(0.25)),2),col="#FF69B4")
lines(y=c(mean(peaksize_sim)+0.15,mean(peaksize_sim)-0.15),x=rep(quantile(peaktime_sim,c(0.75)),2),col="#FF69B4")
lines(x=rep(mean(peaktime_sim),2),y=quantile(peaksize_sim,c(0.25,0.75)),col="#FF69B4",lty=2)
lines(y=rep(quantile(peaksize_sim,c(0.25)),2),x=c(mean(peaktime_sim)+0.3,mean(peaktime_sim)-0.3),col="#FF69B4")
lines(y=rep(quantile(peaksize_sim,c(0.75)),2),x=c(mean(peaktime_sim)+0.3,mean(peaktime_sim)-0.3),col="#FF69B4")
par(mar=c(5.1,5.1,0,2.1))
plot(x=mean(onset_sim,na.rm=T),xlim=c(1,52),y=1,xaxt='n',yaxt="n",ylab="",xlab="Week",pch=19, col="#FF69B4")
axis(1,at=1:52,labels=c(40:52,1:39))
lines(x=quantile(onset_sim,na.rm=T,c(0.25,0.75)),y=rep(1,2),col="#FF69B4",lty=2)
lines(x=rep(quantile(onset_sim,na.rm=T,c(0.25)),2),y=c(1-0.1,1+0.1),col="#FF69B4")
lines(x=rep(quantile(onset_sim,na.rm=T,c(0.75)),2),y=c(1-0.1,1+0.1),col="#FF69B4")
mtext(expression("Onset\nWeek"),side=2,las=1,line=1,cex=0.75,padj=1)
dev.off()
jpeg(paste("Report",report,"_HHS",h,'.jpeg',sep=""),width=918,height=880)
layout(matrix(c(rep(1,8),2),nrow=9))
par(mar=c(1,5.1,2.4,2.1))
plot(0,ylim=c(0,10),xlim=c(1,52),ylab="wILI%",xlab="Week",xaxt='n',col='white',main=paste("HumNat ENVR - HHS Region",h),cex.main=2)
for(yr in 1997:2016) lines(get_flu_data("hhs",h,"ilinet",years=yr)$`% WEIGHTED ILI`,col="grey90",lwd=2)
points(y=today$`% WEIGHTED ILI`,x=1:(cur.week-40+1),pch=19,col="grey50",)
lines(y=today$`% WEIGHTED ILI`,x=1:(cur.week-40+1),col="grey50",lwd=3)
lines(y=c(tail(today$`% WEIGHTED ILI`,1),rowMeans(sim_res_all[[h]])[1:4]),x=(cur.week-40+1):(cur.week-40+5),col="#FF69B4")
points(y=rowMeans(sim_res_all[[h]])[1:4],x= (cur.week-40+2):(cur.week-40+5), col=	"#FF69B4",pch=21,bg="white")
abline(v=(cur.week-40+3),lty=2)
abline(h=baseline[h+1,13],lty=2)
points(y=mean(peaksize_sim),x=mean(peaktime_sim),pch=19,col="#FF69B4")
lines(y=rep(mean(peaksize_sim),2),x=quantile(peaktime_sim,c(0.25,0.75)),col="#FF69B4",lty=2,lwd=2)
lines(y=c(mean(peaksize_sim)+0.15,mean(peaksize_sim)-0.15),x=rep(quantile(peaktime_sim,c(0.25)),2),col="#FF69B4",lwd=2)
lines(y=c(mean(peaksize_sim)+0.15,mean(peaksize_sim)-0.15),x=rep(quantile(peaktime_sim,c(0.75)),2),col="#FF69B4",lwd=2)
lines(x=rep(mean(peaktime_sim),2),y=quantile(peaksize_sim,c(0.25,0.75)),col="#FF69B4",lty=2,lwd=2)
lines(y=rep(quantile(peaksize_sim,c(0.25)),2),x=c(mean(peaktime_sim)+0.3,mean(peaktime_sim)-0.3),col="#FF69B4",lwd=2)
lines(y=rep(quantile(peaksize_sim,c(0.75)),2),x=c(mean(peaktime_sim)+0.3,mean(peaktime_sim)-0.3),col="#FF69B4",lwd=2)
par(mar=c(5.1,5.1,0,2.1))
plot(x=mean(onset_sim,na.rm=T),xlim=c(1,52),y=1,xaxt='n',yaxt="n",ylab="",xlab="Week",pch=19, col="#FF69B4")
axis(1,at=1:52,labels=c(40:52,1:39))
lines(x=quantile(onset_sim,na.rm=T,c(0.25,0.75)),y=rep(1,2),col="#FF69B4",lty=2,lwd=2)
lines(x=rep(quantile(onset_sim,na.rm=T,c(0.25)),2),y=c(1-0.1,1+0.1),col="#FF69B4",lwd=2)
lines(x=rep(quantile(onset_sim,na.rm=T,c(0.75)),2),y=c(1-0.1,1+0.1),col="#FF69B4",lwd=2)
mtext(expression("Onset\nWeek"),side=2,las=1,line=1,cex=0.75,padj=1)
dev.off()
jpeg(paste("Report",report,"_HHS",h,'.jpeg',sep=""),width=918,height=880)
layout(matrix(c(rep(1,8),2),nrow=9))
par(mar=c(1,5.1,2.4,2.1))
plot(0,ylim=c(0,10),xlim=c(1,52),ylab="wILI%",xlab="Week",xaxt='n',col='white',main=paste("HumNat ENVR - HHS Region",h),cex.main=2)
for(yr in 1997:2016) lines(get_flu_data("hhs",h,"ilinet",years=yr)$`% WEIGHTED ILI`,col="grey90",lwd=2)
points(y=today$`% WEIGHTED ILI`,x=1:(cur.week-40+1),pch=19,col="grey50")
lines(y=today$`% WEIGHTED ILI`,x=1:(cur.week-40+1),col="grey50",lwd=3)
lines(y=c(tail(today$`% WEIGHTED ILI`,1),rowMeans(sim_res_all[[h]])[1:4]),x=(cur.week-40+1):(cur.week-40+5),col="#FF69B4",lwd=2)
points(y=rowMeans(sim_res_all[[h]])[1:4],x= (cur.week-40+2):(cur.week-40+5), col=	"#FF69B4",pch=21,bg="white")
abline(v=(cur.week-40+3),lty=2)
abline(h=baseline[h+1,13],lty=2)
points(y=mean(peaksize_sim),x=mean(peaktime_sim),pch=19,col="#FF69B4")
lines(y=rep(mean(peaksize_sim),2),x=quantile(peaktime_sim,c(0.25,0.75)),col="#FF69B4",lty=2,lwd=2)
lines(y=c(mean(peaksize_sim)+0.15,mean(peaksize_sim)-0.15),x=rep(quantile(peaktime_sim,c(0.25)),2),col="#FF69B4",lwd=2)
lines(y=c(mean(peaksize_sim)+0.15,mean(peaksize_sim)-0.15),x=rep(quantile(peaktime_sim,c(0.75)),2),col="#FF69B4",lwd=2)
lines(x=rep(mean(peaktime_sim),2),y=quantile(peaksize_sim,c(0.25,0.75)),col="#FF69B4",lty=2,lwd=2)
lines(y=rep(quantile(peaksize_sim,c(0.25)),2),x=c(mean(peaktime_sim)+0.3,mean(peaktime_sim)-0.3),col="#FF69B4",lwd=2)
lines(y=rep(quantile(peaksize_sim,c(0.75)),2),x=c(mean(peaktime_sim)+0.3,mean(peaktime_sim)-0.3),col="#FF69B4",lwd=2)
par(mar=c(5.1,5.1,0,2.1))
plot(x=mean(onset_sim,na.rm=T),xlim=c(1,52),y=1,xaxt='n',yaxt="n",ylab="",xlab="Week",pch=19, col="#FF69B4")
axis(1,at=1:52,labels=c(40:52,1:39))
lines(x=quantile(onset_sim,na.rm=T,c(0.25,0.75)),y=rep(1,2),col="#FF69B4",lty=2,lwd=2)
lines(x=rep(quantile(onset_sim,na.rm=T,c(0.25)),2),y=c(1-0.1,1+0.1),col="#FF69B4",lwd=2)
lines(x=rep(quantile(onset_sim,na.rm=T,c(0.75)),2),y=c(1-0.1,1+0.1),col="#FF69B4",lwd=2)
mtext(expression("Onset\nWeek"),side=2,las=1,line=1,cex=0.75,padj=1)
dev.off()
today <- get_flu_data("national",,"ilinet",2017)
load(list.files()[grep(submission_date[report],list.files())][1])
jpeg(paste("Report",report,"_national.jpeg",sep=""),width=918,height=880)
layout(matrix(c(rep(1,9),2),nrow=10))
par(mar=c(1,5.1,2.4,2.1))
plot(0,ylim=c(0,10),xlim=c(1,52),ylab="wILI%",xlab="Week",xaxt='n',col='white',main=paste("HumNat ENVR - National"),cex.main=2,cex.lab=2)
for(yr in 1997:2016) lines(get_flu_data("national",,"ilinet",years=yr)$`% WEIGHTED ILI`,col="grey90",lwd=2)
points(y=today$`% WEIGHTED ILI`,x=1:(cur.week-40+1),pch=19,col="grey50",)
lines(y=today$`% WEIGHTED ILI`,x=1:(cur.week-40+1),col="grey50",lwd=3)
lines(y=c(tail(today$`% WEIGHTED ILI`,1),rowMeans(sim_res_national)[1:4]),x=(cur.week-40+1):(cur.week-40+5),col="#FF69B4")
points(y=rowMeans(sim_res_national)[1:4],x= (cur.week-40+2):(cur.week-40+5), col=	"#FF69B4",pch=21,bg="white")
abline(v=(cur.week-40+3),lty=2)
abline(h=baseline[1,13],lty=2)
points(y=mean(peaksize),x=mean(peaktime),pch=19,col="#FF69B4")
lines(y=rep(mean(peaksize),2),x=quantile(peaktime,c(0.25,0.75)),col="#FF69B4",lty=2)
lines(y=c(mean(peaksize)+0.15,mean(peaksize)-0.15),x=rep(quantile(peaktime,c(0.25)),2),col="#FF69B4")
lines(y=c(mean(peaksize)+0.15,mean(peaksize)-0.15),x=rep(quantile(peaktime,c(0.75)),2),col="#FF69B4")
lines(x=rep(mean(peaktime),2),y=quantile(peaksize,c(0.25,0.75)),col="#FF69B4",lty=2)
lines(y=rep(quantile(peaksize,c(0.25)),2),x=c(mean(peaktime)+0.3,mean(peaktime)-0.3),col="#FF69B4")
lines(y=rep(quantile(peaksize,c(0.75)),2),x=c(mean(peaktime)+0.3,mean(peaktime)-0.3),col="#FF69B4")
par(mar=c(5.1,5.1,0,2.1))
plot(x=mean(onsettime,na.rm=T),xlim=c(1,52),y=1,xaxt='n',yaxt="n",ylab="",xlab="Week",pch=19, col="#FF69B4",cex.lab=2)
axis(1,at=1:52,labels=c(40:52,1:39))
lines(x=quantile(onsettime,na.rm=T,c(0.25,0.75)),y=rep(1,2),col="#FF69B4",lty=2)
lines(x=rep(quantile(onsettime,na.rm=T,c(0.25)),2),y=c(1-0.1,1+0.1),col="#FF69B4")
lines(x=rep(quantile(onsettime,na.rm=T,c(0.75)),2),y=c(1-0.1,1+0.1),col="#FF69B4")
mtext(expression("Onset\nWeek"),side=2,las=1,line=1,cex=0.75,padj=1)
dev.off()
today <- get_flu_data("national",,"ilinet",2017)
jpeg(paste("Report",report,"_national.jpeg",sep=""),width=918,height=880)
layout(matrix(c(rep(1,9),2),nrow=10))
par(mar=c(1,5.1,2.4,2.1))
plot(0,ylim=c(0,10),xlim=c(1,52),ylab="wILI%",xlab="Week",xaxt='n',col='white',main=paste("HumNat ENVR - National"),cex.main=2,cex.lab=2)
for(yr in 1997:2016) lines(get_flu_data("national",,"ilinet",years=yr)$`% WEIGHTED ILI`,col="grey90",lwd=2)
points(y=today$`% WEIGHTED ILI`,x=1:(cur.week-40+1),pch=19,col="grey50",)
lines(y=today$`% WEIGHTED ILI`,x=1:(cur.week-40+1),col="grey50",lwd=3)
lines(y=c(tail(today$`% WEIGHTED ILI`,1),rowMeans(sim_res_national)[1:4]),x=(cur.week-40+1):(cur.week-40+5),col="#FF69B4",lwd=2)
points(y=rowMeans(sim_res_national)[1:4],x= (cur.week-40+2):(cur.week-40+5), col=	"#FF69B4",pch=21,bg="white")
abline(v=(cur.week-40+3),lty=2)
abline(h=baseline[1,13],lty=2)
points(y=mean(peaksize),x=mean(peaktime),pch=19,col="#FF69B4")
lines(y=rep(mean(peaksize),2),x=quantile(peaktime,c(0.25,0.75)),col="#FF69B4",lty=2,lwd=2)
lines(y=c(mean(peaksize)+0.15,mean(peaksize)-0.15),x=rep(quantile(peaktime,c(0.25)),2),col="#FF69B4",lwd=2)
lines(y=c(mean(peaksize)+0.15,mean(peaksize)-0.15),x=rep(quantile(peaktime,c(0.75)),2),col="#FF69B4",lwd=2)
lines(x=rep(mean(peaktime),2),y=quantile(peaksize,c(0.25,0.75)),col="#FF69B4",lty=2,lwd=2)
lines(y=rep(quantile(peaksize,c(0.25)),2),x=c(mean(peaktime)+0.3,mean(peaktime)-0.3),col="#FF69B4",lwd=2)
lines(y=rep(quantile(peaksize,c(0.75)),2),x=c(mean(peaktime)+0.3,mean(peaktime)-0.3),col="#FF69B4",lwd=2)
par(mar=c(5.1,5.1,0,2.1))
plot(x=mean(onsettime,na.rm=T),xlim=c(1,52),y=1,xaxt='n',yaxt="n",ylab="",xlab="Week",pch=19, col="#FF69B4",cex.lab=2)
axis(1,at=1:52,labels=c(40:52,1:39))
lines(x=quantile(onsettime,na.rm=T,c(0.25,0.75)),y=rep(1,2),col="#FF69B4",lty=2,lwd=2)
lines(x=rep(quantile(onsettime,na.rm=T,c(0.25)),2),y=c(1-0.1,1+0.1),col="#FF69B4",lwd=2)
lines(x=rep(quantile(onsettime,na.rm=T,c(0.75)),2),y=c(1-0.1,1+0.1),col="#FF69B4",lwd=2)
mtext(expression("Onset\nWeek"),side=2,las=1,line=1,cex=0.75,padj=1)
dev.off()
paste("Report",report)
paste("Report",report,sep=)
paste("Report",report,sep="")
paste("Report",report,"_tmap",sep="")
map("state",fill=T,col=unit_region$col_today,myborder = c(0.1,0.1))
legend('top', pch = 15, col = col_gradient[seq(0,700,50)+1,2], legend = as.numeric(col_gradient[seq(0,700,50)+1,1]), cex = 0.625, bty = 'n',title="Relative wILI%",horiz =T)
title(main = paste('Observation - Week', cur.week))
map("state",fill=T,col=unit_region$col_today,myborder = c(0.1,0.1))
legend('bottom', pch = 15, col = col_gradient[seq(0,700,50)+1,2], legend = as.numeric(col_gradient[seq(0,700,50)+1,1]), cex = 0.625, bty = 'n',title="Relative wILI%",horiz =T)
dev.off()
map("state",fill=T,col=unit_region$col_today,myborder = c(0.1,0.1))
legend('bottom', pch = 15, col = col_gradient[seq(0,700,50)+1,2], legend = as.numeric(col_gradient[seq(0,700,50)+1,1]), cex = 0.625, bty = 'n',title="Relative wILI%",horiz =T)
title(main = paste('Observation - Week', cur.week))
legend('top', pch = 15, col = col_gradient[seq(0,700,50)+1,2], legend = as.numeric(col_gradient[seq(0,700,50)+1,1]), cex = 0.625, bty = 'n',title="Relative wILI%",horiz=T,cex=2)
legend('bottom', pch = 15, col = col_gradient[seq(0,700,50)+1,2], legend = as.numeric(col_gradient[seq(0,700,50)+1,1]), cex = 0.625, bty = 'n',title="Relative wILI%",horiz =T,cex=2)
map("state",fill=T,col=unit_region$col_today,myborder = c(0.1,0.1))
legend('bottom', pch = 15, col = col_gradient[seq(0,700,50)+1,2], legend = as.numeric(col_gradient[seq(0,700,50)+1,1]), cex = 1, bty = 'n',title="Relative wILI%",horiz =T)
title(main = paste('Observation - Week', cur.week))
map("state",fill=T,col=unit_region$col_tomo,myborder = c(0.1,0.1))
map("state",fill=T,col=unit_region$col_today,myborder = c(0.1,0.1))
legend('bottom', pch = 15, col = col_gradient[seq(0,700,50)+1,2], legend = as.numeric(col_gradient[seq(0,700,50)+1,1]), cex = 1, bty = 'n',title="Relative wILI%",horiz =T)
title(main = paste('Observation - Week', cur.week))
setwd("~/Google Drive/Influenza/17-18_forecast/HumNat/html")
jpeg(paste("Report",report,"_tmap.jpeg",sep=""))
map("state",fill=T,col=unit_region$col_today,myborder = c(0.1,0.1))
legend('bottom', pch = 15, col = col_gradient[seq(0,700,50)+1,2], legend = as.numeric(col_gradient[seq(0,700,50)+1,1]), cex = 1, bty = 'n',title="Relative wILI%",horiz =T)
title(main = paste('Observation - Week', cur.week))
dev.off()
setwd("~/Google Drive/Influenza/17-18_forecast/HumNat/html")
jpeg(paste("Report",report,"_tmap.jpeg",sep=""))
map("state",fill=T,col=unit_region$col_today,myborder = c(0.1,0.1))
legend('bottom', pch = 15, col = col_gradient[seq(0,700,50)+1,2], legend = as.numeric(col_gradient[seq(0,700,50)+1,1]), cex = 0.85, bty = 'n',title="Relative wILI%",horiz =T)
title(main = paste('Observation - Week', cur.week))
dev.off()
setwd("~/Google Drive/Influenza/17-18_forecast/HumNat/html")
jpeg(paste("Report",report,"_tmap.jpeg",sep=""),width = 918, height = 880)
map("state",fill=T,col=unit_region$col_today,myborder = c(0.1,0.1))
legend('bottom', pch = 15, col = col_gradient[seq(0,700,50)+1,2], legend = as.numeric(col_gradient[seq(0,700,50)+1,1]), cex = 0.85, bty = 'n',title="Relative wILI%",horiz =T)
title(main = paste('Observation - Week', cur.week))
dev.off()
?mtext
map("state",fill=T,col=unit_region$col_today,myborder = c(0.1,0.1))
legend('bottom', pch = 15, col = col_gradient[seq(0,700,50)+1,2], legend = as.numeric(col_gradient[seq(0,700,50)+1,1]), cex = 0.85, bty = 'n',title="Relative wILI%",horiz =T)
title(main = paste('Observation - Week', cur.week))
mtext(side=3,"jio")
setwd("~/Google Drive/Influenza/17-18_forecast/HumNat/html")
jpeg(paste("Report",report,"_tmap.jpeg",sep=""),width = 918, height = 880)
map("state",fill=T,col=unit_region$col_today,myborder = c(0.1,0.1))
legend('bottom', pch = 15, col = col_gradient[seq(0,700,50)+1,2], legend = as.numeric(col_gradient[seq(0,700,50)+1,1]), cex = 0.85, bty = 'n',title="Relative wILI%",horiz =T)
mtext(side=3,"paste('Observation - Week', cur.week)")
dev.off()
setwd("~/Google Drive/Influenza/17-18_forecast/HumNat/html")
jpeg(paste("Report",report,"_tmap.jpeg",sep=""),width = 918, height = 880)
map("state",fill=T,col=unit_region$col_today,myborder = c(0.1,0.1))
legend('bottom', pch = 15, col = col_gradient[seq(0,700,50)+1,2], legend = as.numeric(col_gradient[seq(0,700,50)+1,1]), cex = 0.85, bty = 'n',title="Relative wILI%",horiz =T)
mtext(side=3,paste('Observation - Week', cur.week),cex=2)
dev.off()
map("state",fill=T,col=unit_region$col_today,myborder = c(0.1,0.1))
legend('bottom', pch = 15, col = col_gradient[seq(0,700,50)+1,2], legend = as.numeric(col_gradient[seq(0,700,50)+1,1]), cex = 0.85, bty = 'n',title="Relative wILI%",horiz =T)
mtext(side=3,paste('Observation - Week', cur.week),cex=2)
jpeg(paste("Report",report,"_t+1map.jpeg",sep=""),width = 918, height = 880)
map("state",fill=T,col=unit_region$col_tomo,myborder = c(0.1,0.1))
legend('top', pch = 15, col = col_gradient[seq(0,700,50)+1,2], legend = as.numeric(col_gradient[seq(0,700,50)+1,1]), cex = 1, bty = 'n',title="Relative wILI%",horiz=T)
mtext(side=3,paste('Observation - Week', cur.week),cex=2)
dev.off()
jpeg(paste("Report",report,"_tmap.jpeg",sep=""),width = 918, height = 880)
map("state",fill=T,col=unit_region$col_today,myborder = c(0.1,0.1))
legend('bottom', pch = 15, col = col_gradient[seq(0,700,50)+1,2], legend = as.numeric(col_gradient[seq(0,700,50)+1,1]), cex = 0.85, bty = 'n',title="Relative wILI%",horiz =T)
mtext(side=3,paste('Forecast - Week', cur.week+1),cex=2)
dev.off()
jpeg(paste("Report",report,"_tmap.jpeg",sep=""),width = 918, height = 880)
map("state",fill=T,col=unit_region$col_today,myborder = c(0.1,0.1))
legend('bottom', pch = 15, col = col_gradient[seq(0,700,50)+1,2], legend = as.numeric(col_gradient[seq(0,700,50)+1,1]), cex = 0.85, bty = 'n',title="Relative wILI%",horiz =T)
mtext(side=3,paste('Observation - Week', cur.week),cex=2)
dev.off()
jpeg(paste("Report",report,"_t+1map.jpeg",sep=""),width = 918, height = 880)
map("state",fill=T,col=unit_region$col_tomo,myborder = c(0.1,0.1))
legend('top', pch = 15, col = col_gradient[seq(0,700,50)+1,2], legend = as.numeric(col_gradient[seq(0,700,50)+1,1]), cex = 1, bty = 'n',title="Relative wILI%",horiz=T)
mtext(side=3,paste('Forecast - Week', cur.week+1),cex=2)
dev.off()
jpeg(paste("Report",report,"_tmap.jpeg",sep=""),width = 918, height = 880)
map("state",fill=T,col=unit_region$col_today,myborder = c(0.1,0.1))
legend('top', pch = 15, col = col_gradient[seq(0,700,50)+1,2], legend = as.numeric(col_gradient[seq(0,700,50)+1,1]), cex = 1, bty = 'n',title="Relative wILI%",horiz =T)
mtext(side=3,paste('Observation - Week', cur.week),cex=2)
dev.off()
jpeg(paste("Report",report,"_t+1map.jpeg",sep=""),width = 918, height = 880)
map("state",fill=T,col=unit_region$col_tomo,myborder = c(0.1,0.1))
legend('top', pch = 15, col = col_gradient[seq(0,700,50)+1,2], legend = as.numeric(col_gradient[seq(0,700,50)+1,1]), cex = 1, bty = 'n',title="Relative wILI%",horiz=T)
mtext(side=3,paste('Forecast - Week', cur.week+1),cex=2)
dev.off()
map("state",fill=T,col=unit_region$col_today,myborder = c(0.1,0.1))
legend('top', pch = 15, col = col_gradient[seq(0,700,50)+1,2], legend = as.numeric(col_gradient[seq(0,700,50)+1,1]), cex = 1, bty = 'n',title="Relative wILI%",horiz =T)
mtext(side=3,paste('Observation - Week', cur.week),cex=2)
jpeg(paste("Report",report,"_tmap.jpeg",sep=""),width = 918, height = 600)
map("state",fill=T,col=unit_region$col_today,myborder = c(0.1,0.1))
legend('top', pch = 15, col = col_gradient[seq(0,700,50)+1,2], legend = as.numeric(col_gradient[seq(0,700,50)+1,1]), cex = 1, bty = 'n',title="Relative wILI%",horiz =T)
mtext(side=3,paste('Observation - Week', cur.week),cex=2)
dev.off()
jpeg(paste("Report",report,"_tmap.jpeg",sep=""),width = 918, height = 600)
map("state",fill=T,col=unit_region$col_today,myborder = c(0.1,0.1))
legend('top', pch = 15, col = col_gradient[seq(0,700,50)+1,2], legend = as.numeric(col_gradient[seq(0,700,50)+1,1]), cex = 1, bty = 'n',title="Relative wILI%",horiz =T)
mtext(side=3,paste('Observation - Week', cur.week),cex=2)
dev.off()
jpeg(paste("Report",report,"_t+1map.jpeg",sep=""),width = 918, height = 600)
map("state",fill=T,col=unit_region$col_tomo,myborder = c(0.1,0.1))
legend('top', pch = 15, col = col_gradient[seq(0,700,50)+1,2], legend = as.numeric(col_gradient[seq(0,700,50)+1,1]), cex = 1, bty = 'n',title="Relative wILI%",horiz=T)
mtext(side=3,paste('Forecast - Week', cur.week+1),cex=2)
jpeg(paste("Report",report,"_t+1map.jpeg",sep=""),width = 918, height = 600)
map("state",fill=T,col=unit_region$col_tomo,myborder = c(0.1,0.1))
legend('top', pch = 15, col = col_gradient[seq(0,700,50)+1,2], legend = as.numeric(col_gradient[seq(0,700,50)+1,1]), cex = 1, bty = 'n',title="Relative wILI%",horiz=T)
mtext(side=3,paste('Forecast - Week', cur.week+1),cex=2)
dev.off()
setwd("~/Google Drive/Influenza/17-18_forecast/HumNat/html")
for(h in 1:10){
today <- get_flu_data("hhs",h,"ilinet",2017)
onset_sim <- peaksize_sim <- peaktime_sim <- rep(NA,ncol(sim_res_all[[h]]))
for(i in 1:length(onset_sim)){
ILI_temp <- c(today$`% WEIGHTED ILI`,sim_res_all[[h]][,i])
above_bl <- (intersect(intersect(which(ILI_temp>baseline[h+1,13]),which(ILI_temp>baseline[h+1,13])+1),which(ILI_temp>baseline[h+1,13])+2)-2)
if (length(above_bl)!=0)  {onset_sim[i] <- min(above_bl)} else {onset_sim[i] <- NA}
peaksize_sim[i] <- max(ILI_temp)
peaktime_sim[i] <- which.max(ILI_temp)
}
jpeg(paste("Report",report,"_HHS",h,'.jpeg',sep=""),width=918,height=880)
layout(matrix(c(rep(1,8),2),nrow=9))
par(mar=c(1,5.1,2.4,2.1))
plot(0,ylim=c(0,10),xlim=c(1,52),ylab="wILI%",xlab="Week",xaxt='n',col='white',main=paste("HumNat ENVR - HHS Region",h),cex.main=2)
for(yr in 1997:2016) lines(get_flu_data("hhs",h,"ilinet",years=yr)$`% WEIGHTED ILI`,col="grey90",lwd=2)
points(y=today$`% WEIGHTED ILI`,x=1:(cur.week-40+1),pch=19,col="grey50")
lines(y=today$`% WEIGHTED ILI`,x=1:(cur.week-40+1),col="grey50",lwd=3)
lines(y=c(tail(today$`% WEIGHTED ILI`,1),rowMeans(sim_res_all[[h]])[1:4]),x=(cur.week-40+1):(cur.week-40+5),col="#FF69B4",lwd=2)
points(y=rowMeans(sim_res_all[[h]])[1:4],x= (cur.week-40+2):(cur.week-40+5), col=	"#FF69B4",pch=21,bg="white")
abline(v=(cur.week-40+3),lty=2)
abline(h=baseline[h+1,13],lty=2)
points(y=mean(peaksize_sim),x=mean(peaktime_sim),pch=19,col="#FF69B4")
lines(y=rep(mean(peaksize_sim),2),x=quantile(peaktime_sim,c(0.25,0.75)),col="#FF69B4",lty=2,lwd=2)
lines(y=c(mean(peaksize_sim)+0.15,mean(peaksize_sim)-0.15),x=rep(quantile(peaktime_sim,c(0.25)),2),col="#FF69B4",lwd=2)
lines(y=c(mean(peaksize_sim)+0.15,mean(peaksize_sim)-0.15),x=rep(quantile(peaktime_sim,c(0.75)),2),col="#FF69B4",lwd=2)
lines(x=rep(mean(peaktime_sim),2),y=quantile(peaksize_sim,c(0.25,0.75)),col="#FF69B4",lty=2,lwd=2)
lines(y=rep(quantile(peaksize_sim,c(0.25)),2),x=c(mean(peaktime_sim)+0.3,mean(peaktime_sim)-0.3),col="#FF69B4",lwd=2)
lines(y=rep(quantile(peaksize_sim,c(0.75)),2),x=c(mean(peaktime_sim)+0.3,mean(peaktime_sim)-0.3),col="#FF69B4",lwd=2)
par(mar=c(5.1,5.1,0,2.1))
plot(x=mean(onset_sim,na.rm=T),xlim=c(1,52),y=1,xaxt='n',yaxt="n",ylab="",xlab="Week",pch=19, col="#FF69B4")
axis(1,at=1:52,labels=c(40:52,1:39))
lines(x=quantile(onset_sim,na.rm=T,c(0.25,0.75)),y=rep(1,2),col="#FF69B4",lty=2,lwd=2)
lines(x=rep(quantile(onset_sim,na.rm=T,c(0.25)),2),y=c(1-0.1,1+0.1),col="#FF69B4",lwd=2)
lines(x=rep(quantile(onset_sim,na.rm=T,c(0.75)),2),y=c(1-0.1,1+0.1),col="#FF69B4",lwd=2)
mtext(expression("Onset\nWeek"),side=2,las=1,line=1,cex=0.75,padj=1)
dev.off()
}
require(devtools); require(knitr)
require(RWordPress); require(XMLRPC)
options(WordpressLogin = c(yangliubeijing = "0810Matt1M0"),
WordpressURL = "https://liux3204.wordpress.com//xmlrpc.php")#alter with your wordpress site address
knit2wp("~/Google Drive/Influenza/17-18_forecast/HumNat/html/Report2.Rmd",title="Something's Title")
options(WordpressLogin = c(yangliubeijing = "0810Matt1M0"),
WordpressURL = "https://umnflu.umn.edu//xmlrpc.php")#alter with your wordpress site address
knit2wp("~/Google Drive/Influenza/17-18_forecast/HumNat/html/Report2.Rmd",title="Something's Title")
options(WordpressLogin = c(yangliubeijing = "0810Matt1M0"),
WordpressURL = "https://umnflu.wordpress.com//xmlrpc.php")#alter with your wordpress site address
knit2wp("~/Google Drive/Influenza/17-18_forecast/HumNat/html/Report2.Rmd",title="Something's Title")
options(WordpressLogin = c(yangliubeijing = "0810Matt1M0"),
WordpressURL = "https://umnflu.wordpress.com//xmlrpc.php")#alter with your wordpress site address
knit2wp("~/Google Drive/Influenza/17-18_forecast/HumNat/html/Report2.Rmd",title="Something's Title")
?knit2wp
knit2wp("~/Google Drive/Influenza/17-18_forecast/HumNat/html/Report2.Rmd",title="Forecast 2: 2017-11-13 (ENVR)", categories=c("forecast","ENVR"))
#setwd("~/Google Drive/Influenza/17-18_forecast/HumNat/html")
setwd("/Users/Yang")
#setwd("~/Google Drive/Influenza/17-18_forecast/HumNat/html")
setwd("/Users/Yang/Git Hub")
#setwd("~/Google Drive/Influenza/17-18_forecast/HumNat/html")
setwd("/Users/Yang/GitHub")
#setwd("~/Google Drive/Influenza/17-18_forecast/HumNat/html")
setwd("/Users/Yang/GitHub/1718flu")
